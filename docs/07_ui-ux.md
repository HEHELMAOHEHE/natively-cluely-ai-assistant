## 7. Интерфейс и пользовательский опыт

Natively предоставляет продвинутый, ориентированный на производительность интерфейс, разработанный для работы в реальном времени во время встреч, собеседований и презентаций.

### Основные компоненты интерфейса

#### Главное окно (Main Window)
Центральный хаб приложения, который содержит:
- **Панель управления ИИ**: управление режимами работы, моделями и настройками
- **Очередь скриншотов**: визуальное представление захваченных изображений
- **Режимы просмотра**: переключение между "очередью" и "решениями"
- **Контрольные элементы**: кнопки для ручного запуска анализа, очистки очереди и экспорта

#### Оверлей (Overlay)
Полупрозрачное поверх других окон окно, которое обеспечивает:
- **Всегда сверху**: работает поверх Zoom, Teams, Meet и других приложений
- **Минималистичный дизайн**: не отвлекает от основной встречи
- **Быстрый доступ**: мгновенное появление/исчезновение по горячим клавишам
- **Отображение рекомендаций**: предложенные ответы, объяснения, подсказки

#### Модальные окна
- **SettingsWindowHelper**: детальные настройки аудио, ИИ, горячих клавиш
- **ModelSelectorWindowHelper**: выбор активной модели ИИ
- **LauncherWindow**: быстрый доступ к основным функциям

### Режимы отображения

#### Normal Mode
Стандартный режим с полным набором функций:
- Видимое окно в доке/панели задач
- Полный доступ ко всем функциям
- Обычное имя процесса и иконка

#### Stealth Mode 2.0 (Режим невидимости)
Продвинутый режим для ситуаций, когда требуется скрыть использование ассистента:

```typescript
public setUndetectable(state: boolean): void {
  this.isUndetectable = state;
  this.windowHelper.setContentProtection(state);
  
  // Применение маскировки
  if (state && this.disguiseMode !== 'none') {
    this._applyDisguise(this.disguiseMode);
  } else if (!state) {
    this._applyDisguise('none');
  }
}
```

**Особенности:**
- Скрытие из дока (macOS) или панели задач (Windows)
- Блокировка скриншотов
- Отключение уведомлений
- Установка флага `accessory` для macOS

#### Disguise Mode (Маскировка)
Система маскировки приложения под системные утилиты:

```typescript
private _applyDisguise(mode: 'terminal' | 'settings' | 'activity' | 'none'): void {
  let appName = "";
  switch (mode) {
    case 'terminal': appName = "Terminal "; break;
    case 'settings': appName = "System Settings "; break;
    case 'activity': appName = "Activity Monitor "; break;
    default: appName = "Natively";
  }
  
  process.title = appName;
  app.setName(appName);
  // ... обновление иконок и заголовков
}
```

**Доступные варианты маскировки:**
- **Terminal**: маскировка под терминал
- **System Settings**: маскировка под системные настройки
- **Activity Monitor**: маскировка под монитор активности
- **None**: стандартное отображение

### Управление окнами

#### Основные методы
```typescript
public createWindow(): void { /* Создание главного окна */ }
public hideMainWindow(): void { /* Скрытие окна */ }
public showMainWindow(): void { /* Показ окна */ }
public toggleMainWindow(): void { /* Переключение видимости */ }
public centerAndShowWindow(): void { /* Центрирование и показ */ }
```

#### Размещение окна
- **moveWindowLeft/right/up/down()**: перемещение окна на одну третью часть экрана
- **centerAndShowWindow()**: центрирование и показ окна
- Автоматическое сохранение последнего положения и размера

### Горячие клавиши

#### Глобальные сочетания
Управляются через `KeybindManager` с возможностью полной кастомизации:

```typescript
// По умолчанию
{
  "general": {
    "toggle-visibility": "CmdOrCtrl+Shift+Space",
    "take-screenshot": "CmdOrCtrl+H",
    "move-left": "CmdOrCtrl+Alt+Left",
    "move-right": "CmdOrCtrl+Alt+Right"
  },
  "ai": {
    "manual-prompt": "CmdOrCtrl+M",
    "regenerate-answer": "CmdOrCtrl+R"
  }
}
```

#### Категории горячих клавиш
1. **Общие (General)**:
   - Показать/скрыть главное окно
   - Сделать скриншот
   - Переместить окно
   - Переключиться на оверлей

2. **AI-функции**:
   - Запрос к ИИ голосом
   - Регенерация ответа
   - Краткий ответ
   - Подробный ответ

3. **Встречи**:
   - Начать запись встречи
   - Завершить встречу
   - Добавить заметку

### Взаимодействие с пользователями

#### Система оповещений
- **Звуковые сигналы**: короткие звуки для различных событий
- **Визуальные индикаторы**: изменение цвета границы окна
- **Тост-уведомления**: временные сообщения о статусе

#### Индикация состояния
- **Уровень громкости**: визуальный индикатор при тестировании микрофона
- **Статус подключения**: индикация активности STT и LLM
- **Прогресс обработки**: анимированные индикаторы при анализе

### Анализ визуального контента

#### Захват скриншотов
```typescript
public async takeScreenshot(
  onBeforeCapture: () => void,
  onAfterCapture: () => void
): Promise<string> {
  onBeforeCapture();
  const screenshotPath = await this.captureScreen();
  this.screenshotQueue.push(screenshotPath);
  onAfterCapture();
  return screenshotPath;
}
```

#### Режимы захвата
1. **Полноэкранный**: автоматический захват всего экрана
2. **Выбор области**: пользователь выбирает область вручную
3. **Автоматический**: по триггерам (например, при обнаружении кода)

#### Очередь скриншотов
- Хранение изображений до ручного анализа
- Визуальное представление в интерфейсе
- Возможность удаления отдельных элементов

### Темы и стиль

#### Управление темами
Реализовано через `ThemeManager`:
- Светлая тема
- Темная тема
- Системная (следует настройкам ОС)

#### Технологии
- **TailwindCSS**: utility-first подход к стилизации
- **React**: компонентный интерфейс
- **Vite**: быстрая сборка и HMR

### UX-особенности

#### Минимизация прерываний
- **Ненавязчивые уведомления**: информация появляется только при необходимости
- **Режим "не беспокоить"**: отключение уведомлений во время важных моментов
- **Адаптивный интерфейс**: автоматическое скрытие второстепенных элементов

#### Производительность
- **Ленивая загрузка**: окна настроек предзагружаются в фоне
- **Оптимизированная отрисовка**: минимальное потребление ресурсов GPU
- **Низкая задержка**: быстрая реакция на действия пользователя

#### Доступность
- Поддержка клавиатурной навигации
- Контрастные цветовые схемы
- Адаптация под различные размеры экранов

### Коммуникация с основным процессом

#### IPC-обработчики
```typescript
ipcMain.handle('get-ollama-models', async () => {
  try {
    const response = await fetch('http://localhost:11434/api/tags');
    if (response.ok) {
      const data = await response.json();
      return data.models.map((m: any) => m.name);
    }
    return [];
  } catch (error) {
    return [];
  }
});
```

#### Основные каналы связи
- `take-screenshot`: запрос на захват экрана
- `screenshot-taken`: уведомление о сделанном скриншоте
- `audio-level`: уровень громкости для визуализации
- `update-available`: наличие обновления
- `intelligence-*`: события от ИИ-модуля

Этот комплексный подход к интерфейсу делает Natively мощным инструментом, который одновременно является ненавязчивым и функциональным, обеспечивая баланс между информативностью и минимализмом.


