## 8. Безопасность и приватность

Natively построен на фундаментальном принципе **"приватность по дизайну" (Privacy by Design)**, что делает его особенно ценным инструментом для профессиональных сценариев, где конфиденциальность данных критически важна.

### Ключевые принципы безопасности

#### Полностью локальная обработка
- **Все данные остаются на устройстве пользователя**: аудио, транскрипции, скриншоты, векторные эмбеддинги
- **Нет внешних серверов**: приложение не имеет бэкенда, который мог бы хранить или анализировать данные
- **Локальная база данных**: SQLite используется для хранения всей информации о встречах
- **Локальный RAG**: система Retrieval Augmented Generation работает полностью локально

#### Отсутствие телеметрии
- **Никакой аналитики**: приложение не собирает никакую информацию о поведении пользователя
- **Нет отслеживания**: не регистрируются действия, время использования, частота запусков
- **Неограниченное использование**: нет подписок, платных планов или скрытых платежей

#### Bring Your Own Keys (BYOK)
- Пользователь предоставляет свои собственные API-ключи для облачных сервисов:
  - Gemini
  - OpenAI
  - Anthropic
  - Groq
  - Google Cloud STT
  - Deepgram
  - ElevenLabs
  - Azure
  - IBM Watson
- Ключи используются только локально и **никогда не покидают устройство**
- При выходе из приложения ключи очищаются из памяти

```typescript
app.on("before-quit", () => {
  CredentialsManager.getInstance().scrubMemory();
  appState.processingHelper.getLLMHelper().scrubKeys();
})
```

### Архитектура безопасности

#### Модуль CredentialsManager
Центральный менеджер учетных данных обеспечивает безопасное хранение:

```typescript
class CredentialsManager {
  private geminiApiKey: string | null = null;
  private groqApiKey: string | null = null;
  private openAiApiKey: string | null = null;
  private claudeApiKey: string | null = null;
  private googleServiceAccountPath: string | null = null;
  private deepgramApiKey: string | null = null;
  // ... другие провайдеры
}
```

**Методы безопасности:**
- `init()`: загрузка ключей из зашифрованного хранилища ОС
- `scrubMemory()`: попытка очистки ключей из памяти перед выходом
- `get*ApiKey()`: безопасное получение ключей по запросу

#### Локальное хранилище
- Используются системные механизмы хранения секретов:
  - **macOS Keychain** для безопасного хранения API-ключей
  - **Windows Credential Vault** для Windows
  - **libsecret** для Linux
- Конфигурация через `.env` файл только для разработки

#### Работа с файловой системой
- Все данные хранятся в пользовательских директориях:
  - Документы (`app.getPath('documents')`)
  - Данные приложения (`app.getPath('userData')`)
  - Кэш (`app.getPath('cache')`)
- Никакие данные не отправляются в облако без явного согласия пользователя

### Режимы приватности

#### Stealth Mode 2.0 (Режим невидимости)
Продвинутая система маскировки для ситуаций, когда требуется скрыть использование ассистента:

```typescript
public setUndetectable(state: boolean): void {
  this.isUndetectable = state;
  this.windowHelper.setContentProtection(state);
  
  if (state && this.disguiseMode !== 'none') {
    this._applyDisguise(this.disguiseMode);
  } else if (!state) {
    this._applyDisguise('none');
  }
}
```

**Особенности:**
- Скрытие из дока (macOS) или панели задач (Windows)
- Блокировка скриншотов
- Отключение уведомлений
- Установка флага `accessory` для macOS

#### Disguise Mode (Маскировка)
Система маскировки под системные утилиты:

```typescript
private _applyDisguise(mode: 'terminal' | 'settings' | 'activity' | 'none'): void {
  let appName = "";
  switch (mode) {
    case 'terminal': appName = "Terminal "; break;
    case 'settings': appName = "System Settings "; break;
    case 'activity': appName = "Activity Monitor "; break;
    default: appName = "Natively";
  }
  
  process.title = appName;
  app.setName(appName);
  // ... обновление иконок и заголовков
}
```

**Доступные варианты:**
- **Terminal**: маскировка под терминал
- **System Settings**: маскировка под системные настройки
- **Activity Monitor**: маскировка под монитор активности
- **None**: стандартное отображение

### Защита данных

#### Шифрование и хранение
- **API-ключи**: хранятся в защищенном хранилище ОС (Keychain, Credential Vault)
- **Транскрипции и заметки**: хранятся в SQLite базе данных в директории пользователя
- **Скриншоты**: временные файлы в кэше, могут быть удалены пользователем

#### Управление доступом
- **Глобальные горячие клавиши**: могут быть полностью настроены пользователем
- **Контроль над захватом экрана**: пользователь должен явно разрешить доступ к экрану в настройках ОС
- **Контроль над микрофоном**: аналогично, требуется явное разрешение ОС

### Обработка ошибок и отказоустойчивость

#### Обработка сбоев
```typescript
// В setupSystemAudioPipeline()
try {
  // Инициализация аудио-каналов
} catch (err) {
  console.error('[Main] Failed to setup System Audio Pipeline:', err);
  // Fallback на дефолтные устройства
}
```

#### Автоматическое восстановление
- При сбое STT-провайдера происходит fallback на GoogleSTT
- При проблемах с устройствами используется автоматический выбор
- Поддержка переконфигурации "на лету"

### Ограничения безопасности

#### Проблемы с JavaScript
- **Невозможность гарантированной очистки памяти**: в JavaScript невозможно принудительно удалить данные из памяти из-за особенностей работы Garbage Collector
- **Ограничения IPC**: коммуникация между процессами требует передачи данных, что потенциально может создать уязвимости
- **Зависимость от Electron**: уязвимости в Chromium или Node.js могут повлиять на безопасность

#### Зависимости сторонних сервисов
- **Облачные провайдеры**: при использовании Gemini, OpenAI и других облачных сервисов, данные передаются третьим лицам
- **API-ключи**: хотя они хранятся локально, их компрометация может привести к злоупотреблению ресурсами пользователя

### Лицензирование и открытый исходный код

#### AGPL-3.0 License
- **Полная прозрачность**: весь исходный код доступен для проверки
- **Защита от закрытия**: если приложение модифицируется и используется по сети, полный исходный код должен быть открыт
- **Отсутствие скрытых функций**: невозможность добавления шпионского ПО без ведома сообщества

#### Аудит безопасности
- Возможность независимого аудита кода любым разработчиком
- Сообщество может выявлять и исправлять уязвимости
- Прозрачность реализации всех критических функций

### Рекомендации по безопасному использованию

1. **Используйте Ollama для полной автономности**: подключение к локальным моделям исключает передачу данных третьим лицам
2. **Регулярно меняйте API-ключи**: особенно при работе на общих или незащищенных устройствах
3. **Используйте режим невидимости**: когда это необходимо для соблюдения политики компании
4. **Очищайте историю встреч**: при необходимости удалите чувствительные данные
5. **Будьте внимательны к настройкам ОС**: контролируйте разрешения на доступ к микрофону, камере и экрану

Natively представляет собой редкий пример баланса между мощными функциями ИИ и строгими требованиями к приватности, делая его одним из самых безопасных решений в своем классе.


